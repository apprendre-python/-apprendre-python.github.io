"use strict";(self.webpackChunkreact_py_docs=self.webpackChunkreact_py_docs||[]).push([[351],{9922:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>w,contentTitle:()=>x,default:()=>C,frontMatter:()=>f,matplotlibCode:()=>k,metadata:()=>g,toc:()=>y});var n=o(7462),l=o(7294),a=o(3905),i=o(1262),s=o(2949),p=o(6816),m=o(9587),r=o(1451),d=o(6533),c=o(4967);const u={enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,highlightActiveLine:!1,showPrintMargin:!1},h=e=>{e.renderer.setScrollMargin(10,10,0,0),e.moveCursorTo(0,0)};function b(e){const{code:t,packages:n}=e,[a,b]=(0,l.useState)(t.trimEnd()),[f,x]=(0,l.useState)(!1);(0,l.useEffect)((()=>{b(t.trimEnd()),x(!1)}),[t]);const{colorMode:g}=(0,s.useColorMode)(),{runPython:w,stdout:y,stderr:k,isLoading:E,isRunning:v,interruptExecution:C}=(0,p.usePython)({packages:n});return l.createElement("div",{className:"xl:flex xl:space-x-4"},l.createElement("div",{className:"relative mb-10 flex flex-col xl:w-1/2"},l.createElement(m.default,{items:[{label:"Run",icon:r,onClick:function(){w(a),x(!0)},disabled:E||v,hidden:v},{label:"Stop",icon:d,onClick:function(){C(),x(!1)},hidden:!v},{label:"Reset",icon:c,onClick:function(){x(!1),b(t.trimEnd())},disabled:v}]}),l.createElement(i.default,{fallback:l.createElement("div",null,"Loading...")},(()=>{const e=o(4981).default;return o(4007),o(2777),o(3783),o(2679),l.createElement(e,{value:a,mode:"python",name:"CodeBlock",fontSize:"0.9rem",className:"min-h-[4rem] overflow-clip rounded shadow-md",theme:"dark"===g?"idle_fingers":"textmate",onChange:e=>b(e),width:"100%",maxLines:1/0,onLoad:h,editorProps:{$blockScrolling:!0},setOptions:u})}))),l.createElement("div",{className:"xl:w-1/2"},l.createElement("h2",null,"Result"),k?l.createElement("pre",{className:"mt-4 text-left"},l.createElement("code",{className:"text-red-500"},k)):y&&y.startsWith("data:image/png;base64,")?l.createElement("img",{src:y}):l.createElement("p",null,"No image yet")))}const f={sidebar_position:9},x="Matplotlib",g={unversionedId:"examples/matplotlib",id:"examples/matplotlib",title:"Matplotlib",description:"By default, matplotlib relies on the import statement from js import document, which does not work from within a web worker.",source:"@site/docs/examples/matplotlib.mdx",sourceDirName:"examples",slug:"/examples/matplotlib",permalink:"/docs/examples/matplotlib",draft:!1,editUrl:"https://github.com/apprendre-python/apprendre-python.github.io/docs/examples/matplotlib.mdx",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9}},w={},y=[{value:"Patching <code>matplotlib.pyplot.show</code>",id:"patching-matplotlibpyplotshow",level:2}],k="import os\nimport base64\nfrom io import BytesIO\n\n# Set this _before_ importing matplotlib\nos.environ['MPLBACKEND'] = 'AGG'\n\nimport matplotlib.pyplot as plt\n\n# Patch\ndef ensure_matplotlib_patch():\n  _old_show = plt.show\n\n  def show():\n    buf = BytesIO()\n    plt.savefig(buf, format='png')\n    buf.seek(0)\n    # Encode to a base64 str\n    img = 'data:image/png;base64,' + \\\n    base64.b64encode(buf.read()).decode('utf-8')\n    # Write to stdout\n    print(img)\n    plt.clf()\n\n  plt.show = show\n\n\nensure_matplotlib_patch()\n\n# Plot\nfig, ax = plt.subplots()\nax.plot([1,3,2])\n\nplt.show()\n",E={toc:y,matplotlibCode:k},v="wrapper";function C(e){let{components:t,...o}=e;return(0,a.mdx)(v,(0,n.default)({},E,o,{components:t,mdxType:"MDXLayout"}),(0,a.mdx)("h1",{id:"matplotlib"},"Matplotlib"),(0,a.mdx)("p",null,"By default, matplotlib relies on the import statement ",(0,a.mdx)("inlineCode",{parentName:"p"},"from js import document"),", which does not work from within a web worker."),(0,a.mdx)("p",null,"One workaround is to patch the default behaviour of ",(0,a.mdx)("inlineCode",{parentName:"p"},"matplotlib.pyplot.show"),"."),(0,a.mdx)("h2",{id:"patching-matplotlibpyplotshow"},"Patching ",(0,a.mdx)("inlineCode",{parentName:"h2"},"matplotlib.pyplot.show")),(0,a.mdx)("p",null,"The following patch sets matplotlib to use the ",(0,a.mdx)("inlineCode",{parentName:"p"},"AGG")," renderer. ",(0,a.mdx)("a",{parentName:"p",href:"https://github.com/pyodide/matplotlib-pyodide/issues/6#issuecomment-1242747625"},"Source"),"."),(0,a.mdx)("admonition",{type:"caution"},(0,a.mdx)("p",{parentName:"admonition"},"This workaround relies on the base64 string to be printed to ",(0,a.mdx)("inlineCode",{parentName:"p"},"stdout"),".")),(0,a.mdx)(b,{code:k,packages:{official:["matplotlib"]},mdxType:"MatplotlibExample"}),(0,a.mdx)("p",null,"You can find the source code for this example ",(0,a.mdx)("a",{parentName:"p",href:"https://github.com/elilambnz/react-py/blob/main/website/src/components/MatplotlibExample.tsx"},"here"),"."))}C.isMDXComponent=!0}}]);